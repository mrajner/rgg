%% this package is extension to rgg.cls
%% to combine several papers
%%
%% it defines 3 command
%%
%% \makecolophon
%% \includerggtex
%% \includerggpdf
%%
%% Marcin Rajner
%% 2016.04.23

\newcounter{inclusion}
\setcounter{inclusion}{0}

\RequirePackage{tocloft}
\tocloftpagestyle{empty}
\newcommand{\listpapers}{\Large Contents}
\newlistof{papers}{pap}{\listpapers}

\renewcommand{\cftpapersleader}{ }

\setlength{\cftbeforepapersskip}{1.6em}
\usepackage{etoolbox}
\RequirePackage{emptypage}
\RequirePackage{standalone}
\RequirePackage{pdfpages}

\RequirePackage{xparse}

\let\titleold=\title
\let\authorold=\author
\renewcommand{\title}[2][]{
  \titleold[#1]{#2}
  \def\thetitle{#2}
}
\renewcommand{\author}[2][]{
  \authorold[#1]{#2}
  \def\theauthor{#2}
}

\def\addtopapers{%
  \addcontentsline{pap}{papers}{
    \hyphenpenalty=10000
    \parbox[t]{0.8\linewidth}{
      {\bfseries\thetitle}
      \newline
      \em\theauthor 
    }
  }
}

\let\maketitleold=\maketitle
\renewcommand{\maketitle}{
  \maketitleold
  \addtopapers
}

\NewDocumentCommand{\includergg}{O{} m O{tex} } {%

  \addtocounter{inclusion}{1}
  \xdef\firstpage{\thepage}
  \def\lastpage{\pageref{LastPage\theinclusion}}
  \begin{refsection}[#2]
    \ifstrequal{#3}{pdf}{
      \addtopapers
      \includepdf[#1]{#2}
    }{%
      \input{#2}
    }
    \label{LastPage\theinclusion}
  \end{refsection}
  \cleardoublepage
}

\def\makecolophon{%
  \clearpage
  \thispagestyle{empty}
  \null\vfill
  \noindent
  \rgg\\
  volume \rgg@volume, number \rgg@number, \rgg@year\\
  \\
  Editor in Chief\\
  MB\\
  \\
  Editorial Board\\
  \ldots\\
  \\
  Technical Editor\\
  Dominik Pr√≥chniewicz\\
  \\
  \url{http://www.reports.gik.pw.edu.pl}\\
  \href{mailto:reports.geodesy@gmail.com}
  {\texttt{reports.geodesy@gmail.com}}\\
  \\
  ISSN \rgg@ISSN
  \clearpage%
}
