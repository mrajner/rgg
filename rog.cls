%% This file is LaTeX class for submission
%% to Reports on Geodesy and Geoinformatics
%%
%% this class follows author guidelines specified at
%% http://www.reports.gik.pw.edu.pl
%% and mimic the official Word template

%% DO NOT edit this file directly
%% put all your additional settings
%% inside your .tex file(s) submitted to editors.

%% If you believe that there is a bug in this class
%% or you encountered any incompatibilities
%% or other technical issues
%% or you need any fancy setting which cannot be achieved
%% without touching this class file
%% please contact mrajner@gik.pw.edu.pl

%% created 20151116 Marcin Rajner

\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{rog}[2015/11/16]

\LoadClass[12pt,twoside]{article}
%% use standard article rules by default
%% with 12 point font size

%% process class options
\RequirePackage{kvoptions}
\SetupKeyvalOptions{
   family=rog,
   prefix=rog@,
}
\DeclareStringOption[1]{startpage}
\DeclareStringOption[]{volume}
\DeclareStringOption[]{doi}
\DeclareStringOption[year]{year}
\DeclareBoolOption{review}
\ProcessKeyvalOptions*

\setcounter{page}{\rog@startpage}

\ifrog@review
\RequirePackage{lineno}
\linenumbers
\linespread{2}
\fi

%% English language rules for all document
\RequirePackage[english]{babel}

%% use a4 paper size with all margins set to 2.5 cm
\RequirePackage
[
  a4paper,
  margin = 2.5cm,
]
{geometry}

%% font selection according to engine used in compilation
\RequirePackage{ifxetex,ifluatex}
\newif\ifxetexorluatex
\ifxetex
  \xetexorluatextrue
\else
  \ifluatex
    \xetexorluatextrue
  \else
    \xetexorluatexfalse
  \fi
\fi

\ifxetexorluatex
  %% if you compile document using xelatex or lualatex you can
  %% directly access system fonts
  %% while Arial is not free font and could not be installed
  %% on every machine you can use linux substitute named
  %% Liberation Sans
  %% if you have Arial installed you can uncomment
  %% line \setmainfont{Arial}
  \RequirePackage{fontspec}
  \setmainfont{Liberation Sans}
  % \setmainfont{Arial}
\else
  %% Unicode support for (pdf)latex
  \RequirePackage[utf8]{inputenc}
  \RequirePackage[scaled]{helvet}
\fi

%% use sans-serif font for whole document
\renewcommand{\familydefault}{\sfdefault}

%% maketitle command style
\renewcommand\maketitle{
  % title bold and centred and all in upper case
  \vspace*{6em}
    \parbox{14cm}{
  \begin{center}
    {\bfseries\large\MakeUppercase{\@title}\par}
  \end{center}
  }
  % \vspace*{0.6cm}
  \begin{center}
    {\@author}\\
    % \vspace*{0.5cm}
    {\@affiliation}
    % {\texttt{\@email}}
    \end{center}
  % \vspace*{1.1 cm}
  % \vskip 30\p@ \@plus 10\p@ \@minus 2\p@
  % }
}
% \RequirePackage{natbib}
%
\RequirePackage{floatrow}
\floatsetup[table]{
  capposition=top,
}
% \floatsetup[figure]{
% }

%
%% float environments
%% center figures
% \g@addto@macro\@floatboxreset{\centering}
% \renewcommand\figurename{Fig.}
% \renewcommand\tablename{Tab.}

\RequirePackage{booktabs}


%% affiliation environment
\newcommand\affiliation[1]{\gdef\@affiliation{#1}}
\gdef\@affiliation{}
\newcommand\email[1]{\gdef\@email{#1}}
\gdef\@email{}
\renewcommand\author{\@ifnextchar [{\@authortwo}{\@authorone}}%}
\def\@authortwo[#1]#2{\gdef\@author{#2}\gdef\@shortauthor{#1}}
\def\@authorone#1{\gdef\@author{#1}%}
\begingroup\def\and{and}\gdef\@shortauthor{#1}\endgroup}
\gdef\@author{\mbox{}}

\newcommand\shortauthor[1]{\gdef\@shortauthor{#1}}
\gdef\@shortauthor{}

%
% % no additional space between bibliography entries
% \setlength{\bibsep}{0.0pt}
%
% \parindent=0.6cm
% \pagestyle{empty}
%

%
% % abstract and keywords commands
% \renewcommand\abstract[1]{{\bf\noindent\uppercase{abstract}.\enspace}#1}
% \newcommand\keywords[1]{\par\vspace{0.5em}\noindent {\bf Keywords: }#1}
%
% redefinition of section and subsection environment
\renewcommand{\@seccntformat}[1]{\csname the#1\endcsname.\quad}
\renewcommand\section{%
    \@startsection {section}{1}{\z@}%
    {-1em \@plus -1ex \@minus -.2ex}%
    {0.5em \@plus.2ex}%
    {\normalfont\bfseries}%
  }
\renewcommand\subsection{\@startsection {subsection}{1}{\z@}%
    {-0.6em \@plus -1ex \@minus -.2ex}%
    {0.3em \@plus.2ex}%
    {\normalfont\bfseries}%
  }%}

%


%% apply ``better'' microtypography
\RequirePackage{microtype}

%% enhance math
\RequirePackage{amsmath}
\RequirePackage{amssymb}

%% Use the APA format as a style of citation and reference list (see Guidelines for APA Citation Style with examples)
\bibliographystyle{apacite}

%% include graphics
\RequirePackage{graphicx}

%% abstract and keywords

\newcommand\keywords[1]{\long\gdef\@keywords{#1}}
\gdef\@keywords{}
\renewenvironment{abstract}
{
  \setlength{\leftmargin}{5em}%
    \list{}{\setlength{\rightmargin}{\leftmargin}}%
  \item\relax{\bfseries \abstractname}\newline
    \itshape
  }{\upshape\newline\vskip-0.5em
    \textbf{Keywords:}
    \@keywords
  \endlist}

\RequirePackage{lastpage}
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\RequirePackage{changepage}
\def\headerfirstpage{%
  \textit{Reports on Geodesy and Geoinformatics}
  vol.\,\rog@volume/\rog@year; pages \rog@startpage-\pageref{LastPage}%
}
\def\doi{\textsc{doi:}\rog@doi}


%% acknowledgement
\newcommand\acknowledgement[1]{\gdef\@acknowledgement{#1}}
\gdef\@acknowledgement{}

%%%%%%%%%% TODO: DISCUSS WITH EDITORS %%%%%%%%%%%%%%%%
% \strictpagecheck
% \checkoddpage
% \ifoddpage
\fancyhead[LO]{\headerfirstpage}
\fancyhead[RO]{\doi}
% \else
% \fancyhead[LO]{\headerfirstpage}
% \fancyhead[RO]{\doi}
% \fi

\RequirePackage{sansmath}
\sansmath

\endinput
